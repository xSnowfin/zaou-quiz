<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ« è¬è§£ãã‚¯ã‚¤ã‚ºãƒ©ãƒªãƒ¼ï¼</title>
  <style>
    body {
      font-family: 'Comic Sans MS', 'Arial', sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      background: url("zaou.JPG") no-repeat center center fixed;
      background-size: cover;
    }
    h1 {
      color: #ff6600;
      text-shadow: 2px 2px #fff;
      font-size: 2.2em;
      margin-bottom: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: rgba(255, 255, 255, 0.65);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .question { font-size: 1.3em; margin: 20px 0; color: #333; }
    .options button {
      display: block; width: 100%; margin: 8px 0; padding: 12px;
      border: none; border-radius: 15px; background: #87cefa;
      font-size: 1.1em; cursor: pointer; transition: transform 0.1s, background 0.3s;
    }
    .options button:hover { background: #1e90ff; color: white; }
    .options button:active { transform: scale(0.9); }
    .hint {
      font-size: 1em; color: #555; background: #f0f8ff; padding: 8px;
      margin-top: 10px; border-left: 4px solid #00bfff;
      border-radius: 10px; display: none;
    }
    .keyword {
      color: #228b22; font-weight: bold; font-size: 1.3em;
      margin: 10px 0; background: #e0ffe0; padding: 5px; border-radius: 10px;
      display: inline-block;
    }
    #final-step input {
      padding: 10px; font-size: 1.2em; border-radius: 10px;
      border: 2px solid #aaa; margin: 10px 0; width: 80%; max-width: 300px;
    }
    #final-step button {
      background: #ffcc00; padding: 10px 20px; font-size: 1.2em;
      border: none; border-radius: 15px; cursor: pointer; transition: background 0.3s;
    }
    #final-step button:hover { background: #ffaa00; }
    #final-result { font-size: 1.3em; margin-top: 15px; font-weight: bold; }
    #final-result.success {
      animation: fadeIn 1s ease-in-out;
      color: green;
    }
    #retry-counter {
      color: red;
      font-weight: bold;
      margin-top: 10px;
      font-size: 1.2em;
      display: none;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>
  <h1>è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ« è¬è§£ãã‚¯ã‚¤ã‚ºãƒ©ãƒªãƒ¼ï¼</h1>
  <div class="container" id="main-container">
    <!-- ã‚«ã‚¦ãƒ³ãƒˆç”¨è¦ç´ ã¯æœ€åˆã‹ã‚‰ã“ã“ã«é…ç½® -->
    <div id="retry-counter"></div>
  </div>

  <!-- åŠ¹æœéŸ³ -->
  <audio id="correct-sound" src="sounds/correct.mp3" preload="auto"></audio>
  <audio id="wrong-sound" src="sounds/wrong.mp3" preload="auto"></audio>
  <audio id="goal-sound" src="sounds/goal.mp3" preload="auto"></audio>

  <!-- ç´™å¹é›ªãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const quizzes = {
      '1': { question: "è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ãŒå»ºè¨­ã•ã‚ŒãŸã®ã¯ã„ã¤ã§ã—ã‚‡ã†ã‹?",
        options: ["1976å¹´", "1978å¹´", "1980å¹´", "1982å¹´"], correct: 1, keyword: "ãƒ„",
        hint: "å—ä»˜ã§é…ã£ãŸãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆã‚’è¦‹ã‚ˆã†!" },
      '2': { question: "ã‚¸ãƒ£ãƒ³ãƒ—å°ã®ä¸‹ã‹ã‚‰ä¸Šã¾ã§ã®æ¨™é«˜å·®ã¨è¿‘ã„é«˜ã•ã®å»ºç‰©ã¯ã©ã‚Œã§ã—ã‚‡ã†ã‹?",
        options: ["å±±å½¢å¸‚å½¹æ‰€", "å±±å½¢çœŒåº", "ä¸Šå±±ã‚¹ã‚«ã‚¤ã‚¿ãƒ¯ãƒ¼", "éœåŸã‚»ãƒ³ãƒˆãƒ©ãƒ«"], correct: 3, keyword: "ãƒ£",
        hint: "ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒŠãƒ¼æ¨ªã®çœ‹æ¿ã‚’è¦‹ã¦ã¿ã‚ˆã†!" },
      '3': { question: "é«™æ¢¨æ²™ç¾…é¸æ‰‹ãŒè”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ã§å‡ºã—ãŸæœ€å¤§ã®é£›è·é›¢ã¯ï¼Ÿ",
        options: ["101.0m", "103.5m", "106.0m", "108.5m"], correct: 2, keyword: "ã‚§",
        hint: "ã‚¸ãƒ£ãƒ³ãƒ—å°ã«è¨­ç½®ã•ã‚Œã¦ã„ã‚‹çœ‹æ¿ã‚’è¦‹ã¦ã¿ã‚ˆã†!" },
      '4': { question: "ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ¼ãƒ³ã®æœ€å¤§æ–œåº¦ã¯ä½•åº¦ï¼Ÿ",
        options: ["35åº¦", "36.5åº¦", "38åº¦", "39.5åº¦"], correct: 1, keyword: "ã‚·",
        hint: "å—ä»˜ã§é…ã£ãŸãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆã‚’è¦‹ã‚ˆã†!" },
      '5': { question: "8æœˆã®ã‚µãƒãƒ¼ã‚¸ãƒ£ãƒ³ãƒ—å¤§ä¼šã§ç¬¬2ä½ã®å†…è—¤æ™ºæ–‡é¸æ‰‹ã®å‹¤å‹™å…ˆã¯ï¼Ÿ",
        options: ["è”µç‹æ¸©æ³‰å®¿æ³Šæ–½è¨­", "è”µç‹æ¸©æ³‰ã‚¹ã‚­ãƒ¼å ´", "å±±å½¢çœŒè·å“¡", "å±±å½¢å¸‚è·å“¡"], correct: 3, keyword: "ãƒ³",
        hint: "å—ä»˜ãƒ†ãƒ³ãƒˆã®æ–°èã‚³ãƒ”ãƒ¼ã‚’è¦‹ã¦ã¿ã‚ˆã†!" }
    };
    const finalAnswer = "ã‚·ãƒ£ãƒ³ãƒ„ã‚§";

    const params = new URLSearchParams(window.location.search);
    const qid = params.get("q");

    const container = document.getElementById("main-container");
    const counterEl = document.getElementById("retry-counter");

    function playSound(id) {
      const sound = document.getElementById(id);
      if (sound) {
        sound.currentTime = 0;
        sound.play();
      }
    }

    if (qid) {
      const quiz = quizzes[qid];
      if (!quiz) {
        container.innerHTML += "<p>ã‚¯ã‚¤ã‚ºãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>";
      } else {
        // ã‚¯ã‚¤ã‚ºå†…å®¹ã‚’è¡¨ç¤º
        let html = `<div class="question">${quiz.question}</div>`;
        html += `<div class="options">`;
        quiz.options.forEach((opt, i) => {
          html += `<button onclick="checkAnswer(${i}, '${qid}')">${opt}</button>`;
        });
        html += `</div>`;
        html += `<button onclick="document.getElementById('hint').style.display='block'">ğŸ’¡ ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>`;
        html += `<div class="hint" id="hint">${quiz.hint}</div>`;
        container.innerHTML += html; // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¯æ¶ˆã•ãšè¿½åŠ 
      }
    } else {
      // ã‚´ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸
      let keywords = [];
      Object.keys(quizzes).forEach(id => {
        const k = localStorage.getItem(`quiz${id}_cleared`);
        if (k) keywords.push(k);
      });

      let html = `<h2>å•é¡ŒãŒ5ã¤ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã¯ã‚è¾¼ã‚“ã§ç­”ãˆã‚’å°ãã ãã†ï¼</h2>`;
      if (keywords.length > 0) {
        html += keywords.map(k => `<div class="keyword">${k}</div>`).join("");
      } else {
        html += "<p>ã¾ã ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é›†ã‚ã¦ã„ã¾ã›ã‚“ã€‚</p>";
      }

      if (keywords.length === Object.keys(quizzes).length) {
        html += `
          <div class="hint" style="display:block; margin-top:15px; font-weight:bold;">
            ğŸ’¡ ãƒ’ãƒ³ãƒˆ: è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ã®åˆ¥åã¯ã€Œã‚¢ãƒªã‚ªãƒ³ãƒ†ãƒƒã‚¯è”µç‹ã€‡ã€‡ã€‡ã€‡ã€‡ã€
          </div>
          <div id="final-step">
            <input type="text" id="final-answer" placeholder="ç­”ãˆã‚’å…¥åŠ›"><br>
            <button onclick="checkFinalAnswer()">é€ä¿¡</button>
            <p id="final-result"></p>
            <div id="survey-link"></div>
          </div>
        `;
      } else {
        html += `<p style="color:red; font-weight:bold;">âš ï¸ ã¾ã å…¨ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é›†ã‚ã¦ã„ã¾ã›ã‚“ï¼</p>`;
      }

      container.innerHTML += html;
    }

    function checkAnswer(selected, id) {
      const quiz = quizzes[id];
      const buttons = document.querySelectorAll(".options button");

      if (selected === quiz.correct) {
        alert("â­• æ­£è§£ï¼ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã€" + quiz.keyword + "ã€ã§ã™");
        localStorage.setItem(`quiz${id}_cleared`, quiz.keyword);
        playSound("correct-sound");
        confetti();
      } else {
        playSound("wrong-sound");

        buttons.forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = "0.5";
        });

        let count = 5;
        counterEl.style.display = "block";
        counterEl.textContent = `âŒ æ®‹å¿µï¼ ${count}ç§’å¾Œã«å†æŒ‘æˆ¦ã§ãã¾ã™`;

        const interval = setInterval(() => {
          count--;
          if (count > 0) {
            counterEl.textContent = `âŒ æ®‹å¿µï¼ ${count}ç§’å¾Œã«å†æŒ‘æˆ¦ã§ãã¾ã™`;
          } else {
            clearInterval(interval);
            counterEl.style.display = "none";
            buttons.forEach(btn => {
              btn.disabled = false;
              btn.style.opacity = "1";
            });
          }
        }, 1000);
      }
    }

    function checkFinalAnswer() {
      const ans = document.getElementById("final-answer").value.trim();
      const result = document.getElementById("final-result");
      const survey = document.getElementById("survey-link");

      if (ans === finalAnswer) {
        result.innerHTML = "ğŸ‰ ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼";
        result.classList.add("success");
        playSound("goal-sound");
        confetti();
        survey.innerHTML = `<p><a href="https://forms.gle/mfHe6rbxjTjCdYtG6" target="_blank">ğŸ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã”å”åŠ›ãã ã•ã„ï¼</a></p>`;
      } else {
        result.innerHTML = "âŒ ç­”ãˆãŒé•ã†ã¿ãŸã„ã â€¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¦‹ç›´ã—ã¦ã¿ã‚ˆã†ï¼";
        survey.innerHTML = "";
        playSound("wrong-sound");
      }
    }
  </script>
</body>
</html>
