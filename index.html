<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ« è¬è§£ãã‚¯ã‚¤ã‚ºãƒ©ãƒªãƒ¼ï¼</title>
  <style>
    body {
      font-family: 'Comic Sans MS', 'Arial', sans-serif;
      text-align: center;
      padding: 12px;
      margin: 0;
      background: url("zaou.JPG") no-repeat center center fixed;
      background-size: cover;
    }
    h1 {
      color: #ff6600;
      text-shadow: 2px 2px #fff;
      font-size: 2.2em;
      margin-bottom: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: rgba(255, 255, 255, 0.65);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .question { font-size: 1.3em; margin: 20px 0; color: #333; }
    .options button {
      display: block; width: 100%; margin: 8px 0; padding: 12px;
      border: none; border-radius: 15px; background: #87cefa;
      font-size: 1.1em; cursor: pointer; transition: transform 0.1s, background 0.3s;
    }
    .options button:hover { background: #1e90ff; color: white; }
    .options button:active { transform: scale(0.9); }
    .hint {
      font-size: 1em; color: #555; background: #f0f8ff; padding: 8px;
      margin-top: 10px; border-left: 4px solid #00bfff;
      border-radius: 10px; display: none;
    }
    .keyword {
      color: #228b22;
      font-weight: bold;
      font-size: 1.8em;
      margin: 20px 0;
      background: #e0ffe0;
      padding: 15px 20px;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
    }
    .keyword .char {
      display: inline-block;
      margin: 0 6px; /* â† ã¡ã‚‡ã£ã¨ã ã‘é–“éš” */
    }
    #final-step input {
      padding: 10px; font-size: 1.2em; border-radius: 10px;
      border: 2px solid #aaa; margin: 10px 0; width: 80%; max-width: 300px;
    }
    #final-step button {
      background: #ffcc00; padding: 10px 20px; font-size: 1.2em;
      border: none; border-radius: 15px; cursor: pointer; transition: background 0.3s;
    }
    #final-step button:hover { background: #ffaa00; }
    #final-result { font-size: 1.3em; margin-top: 15px; font-weight: bold; }
    #final-result.success {
      animation: fadeIn 1s ease-in-out;
      color: green;
    }
    #retry-counter {
      color: red;
      font-weight: bold;
      margin-top: 10px;
      font-size: 1.2em;
      display: none;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    /* è¿½åŠ : ç”»é¢ä¸‹éƒ¨ã«è¡¨ç¤ºã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒœãƒƒã‚¯ã‚¹ï¼ˆæœ€çµ‚å•é¡Œã¨åŒã˜è¦‹ãŸç›®ï¼‰ */
#collected-keywords-bottom {
  display: inline-flex;          /* ğŸ‘ˆ æ–‡å­—ã®å¹…ã«åˆã‚ã›ã¦ä¼¸ç¸® */
  justify-content: center;
  flex-wrap: nowrap;
 
  margin-top:20px;
  left: 50%;
  transform: translateX(-50%);
  bottom: 45px;
  z-index: 1200;
  display: none;           /* ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨ãã ã‘è¡¨ç¤º */
  max-width: 92%;
  padding: 8px 12px;
  background: rgba(255,255,255,0.92);
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  text-align: center;
  display: table;                
  margin-left: auto;
  margin-right: auto;
}
/* å†…éƒ¨ã® .keyword ã¯æ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ã†ã®ã§åŸºæœ¬ãã®ã¾ã¾ã€‚
   ãŸã ã—ãƒœãƒƒã‚¯ã‚¹å†…ã®ä½™ç™½ã‚„å½±ã¯æŠ‘ãˆã‚‹ */
#collected-keywords-bottom .keyword {
  margin: 0;
  background: transparent;
  padding: 0;
  box-shadow: none;
}
/* .char ã®é–“éš”ã¯æ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ã†ãŒå¿…è¦ãªã‚‰ä¸Šæ›¸ã */
#collected-keywords-bottom .char { margin: 0 6px; font-size: 1.4em; display: inline-block; }

  </style>
</head>
<body>
  <h1>è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ« è¬è§£ãã‚¯ã‚¤ã‚ºãƒ©ãƒªãƒ¼ï¼</h1>
  <div class="container" id="main-container">
    <div id="retry-counter"></div>
  </div>

  <!-- åŠ¹æœéŸ³ -->
  <audio id="correct-sound" src="sounds/correct.mp3" preload="auto"></audio>
  <audio id="wrong-sound" src="sounds/wrong.mp3" preload="auto"></audio>
  <audio id="goal-sound" src="sounds/goal.mp3" preload="auto"></audio>

  <!-- ç´™å¹é›ªãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const quizzes = {
      '1': { question: "è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ãŒå»ºè¨­ã•ã‚ŒãŸã®ã¯ã„ã¤ã§ã—ã‚‡ã†ã‹?",
        options: ["1976å¹´", "1978å¹´", "1980å¹´", "1982å¹´"], correct: 1, keyword: "ãƒ„",
        hint: "å—ä»˜ã§é…ã£ãŸãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆã‚’è¦‹ã‚ˆã†!" },
      '2': { question: "ã‚¸ãƒ£ãƒ³ãƒ—å°ã®ä¸‹ã‹ã‚‰ä¸Šã¾ã§ã®æ¨™é«˜å·®ã¨è¿‘ã„é«˜ã•ã®å»ºç‰©ã¯ã©ã‚Œã§ã—ã‚‡ã†ã‹?",
        options: ["å±±å½¢å¸‚å½¹æ‰€", "å±±å½¢çœŒåº", "ä¸Šå±±ã‚¹ã‚«ã‚¤ã‚¿ãƒ¯ãƒ¼", "éœåŸã‚»ãƒ³ãƒˆãƒ©ãƒ«"], correct: 3, keyword: "ãƒ£",
        hint: "ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒŠãƒ¼æ¨ªã®çœ‹æ¿ã‚’è¦‹ã¦ã¿ã‚ˆã†!" },
      '3': { question: "é«™æ¢¨æ²™ç¾…é¸æ‰‹ãŒè”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ã§å‡ºã—ãŸæœ€å¤§ã®é£›è·é›¢ã¯ï¼Ÿ",
        options: ["101.0m", "103.5m", "106.0m", "108.5m"], correct: 2, keyword: "ã‚§",
        hint: "ã‚¸ãƒ£ãƒ³ãƒ—å°ã«è¨­ç½®ã•ã‚Œã¦ã„ã‚‹çœ‹æ¿ã‚’è¦‹ã¦ã¿ã‚ˆã†!" },
      '4': { question: "ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ¼ãƒ³ã®æœ€å¤§æ–œåº¦ã¯ä½•åº¦ï¼Ÿ",
        options: ["35åº¦", "36.5åº¦", "38åº¦", "39.5åº¦"], correct: 1, keyword: "ã‚·",
        hint: "å—ä»˜ã§é…ã£ãŸãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆã‚’è¦‹ã‚ˆã†!" },
      '5': { question: "8æœˆã®ã‚µãƒãƒ¼ã‚¸ãƒ£ãƒ³ãƒ—å¤§ä¼šã§ç¬¬2ä½ã®å†…è—¤æ™ºæ–‡é¸æ‰‹ã®å‹¤å‹™å…ˆã¯ï¼Ÿ",
        options: ["è”µç‹æ¸©æ³‰å®¿æ³Šæ–½è¨­", "è”µç‹æ¸©æ³‰ã‚¹ã‚­ãƒ¼å ´", "å±±å½¢çœŒè·å“¡", "å±±å½¢å¸‚è·å“¡"], correct: 3, keyword: "ãƒ³",
        hint: "å—ä»˜ãƒ†ãƒ³ãƒˆã®æ–°èã‚³ãƒ”ãƒ¼ã‚’è¦‹ã¦ã¿ã‚ˆã†!" }
    };
    const finalAnswer = "ã‚·ãƒ£ãƒ³ãƒ„ã‚§";

    const container = document.getElementById("main-container");
    const counterEl = document.getElementById("retry-counter");

    function playSound(id) {
      const sound = document.getElementById(id);
      if (sound) {
        sound.currentTime = 0;
        sound.play();
      }
    }

    // ãƒšãƒ¼ã‚¸ã‚’æç”»ã™ã‚‹é–¢æ•°
    function renderPage() {
      container.innerHTML = '<div id="retry-counter"></div>'; // åˆæœŸåŒ–
      const counterEl = document.getElementById("retry-counter");

      let qid = null;
      if (window.location.hash) {
        qid = window.location.hash.replace("#q", "");
      }

      if (qid) {
        const quiz = quizzes[qid];
        if (!quiz) {
          container.innerHTML += "<p>ã‚¯ã‚¤ã‚ºãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>";
        } else {
          let html = `<div class="question">${quiz.question}</div>`;
          html += `<div class="options">`;
          quiz.options.forEach((opt, i) => {
            html += `<button onclick="checkAnswer(${i}, '${qid}')">${opt}</button>`;
          });
          html += `</div>`;
          html += `<button onclick="document.getElementById('hint').style.display='block'">ğŸ’¡ ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>`;
          html += `<div class="hint" id="hint">${quiz.hint}</div>`;
          container.innerHTML += html;
        }
      } else {
        let keywords = [];
        Object.keys(quizzes).forEach(id => {
          const k = localStorage.getItem(`quiz${id}_cleared`);
          if (k) keywords.push(k);
        });

        let html = `<h2>å•é¡ŒãŒ5ã¤ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã¯ã‚è¾¼ã‚“ã§ç­”ãˆã‚’å°ãã ãã†ï¼</h2>`;
        if (keywords.length > 0) {
          // é›†ã‚ãŸã‚‚ã®ã ã‘ã‚’é †ã«ãƒãƒ©æ–‡å­—è¡¨ç¤º
          html += `<div class="keyword">` +
            keywords.map(k =>
              k.split("").map(ch => `<span class="char">${ch}</span>`).join("")
            ).join("") +
            `</div>`;
        } else {
          html += "<p>ã¾ã ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é›†ã‚ã¦ã„ã¾ã›ã‚“ã€‚</p>";
        }

        if (keywords.length === Object.keys(quizzes).length) {
          html += `
            <div class="hint" style="display:block; margin-top:15px; font-weight:bold;">
              ğŸ’¡ ãƒ’ãƒ³ãƒˆ: è”µç‹ã‚¸ãƒ£ãƒ³ãƒ—å°ã®åˆ¥åã¯ã€Œã‚¢ãƒªã‚ªãƒ³ãƒ†ãƒƒã‚¯è”µç‹ã€‡ã€‡ã€‡ã€‡ã€‡ã€
            </div>
            <div id="final-step">
              <input type="text" id="final-answer" placeholder="ç­”ãˆã‚’å…¥åŠ›"><br>
              <button onclick="checkFinalAnswer()">é€ä¿¡</button>
              <p id="final-result"></p>
              <div id="survey-link"></div>
            </div>
          `;
        } else {
          html += `<p style="color:red; font-weight:bold;">âš ï¸ ã¾ã å…¨ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é›†ã‚ã¦ã„ã¾ã›ã‚“ï¼</p>`;
        }

        container.innerHTML += html;
      }
    }

    function checkAnswer(selected, id) {
      const quiz = quizzes[id];
      const buttons = document.querySelectorAll(".options button");

      if (selected === quiz.correct) {
        alert("â­• æ­£è§£ï¼ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã€" + quiz.keyword + "ã€ã§ã™");
        localStorage.setItem(`quiz${id}_cleared`, quiz.keyword);
        playSound("correct-sound");
        confetti();
        // ã“ã“ã‚’è¿½åŠ ï¼ˆæ­£è§£ã—ãŸã‚‰å³åº§ã«ä¸‹éƒ¨è¡¨ç¤ºã‚’æ›´æ–°ï¼‰
      updateCollectedKeywordsBottom();
      } else {
        alert("âŒ æ®‹å¿µï¼5ç§’å¾Œã«ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã‚ˆã†ï¼"); 
        playSound("wrong-sound");

        buttons.forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = "0.5";
        });

        let count = 5;
        counterEl.style.display = "block";
        counterEl.textContent = `âŒ æ®‹å¿µï¼ ${count}ç§’å¾Œã«å†æŒ‘æˆ¦ã§ãã¾ã™`;

        const interval = setInterval(() => {
          count--;
          if (count > 0) {
            counterEl.textContent = `âŒ æ®‹å¿µï¼ ${count}ç§’å¾Œã«å†æŒ‘æˆ¦ã§ãã¾ã™`;
          } else {
            clearInterval(interval);
            counterEl.style.display = "none";
            buttons.forEach(btn => {
              btn.disabled = false;
              btn.style.opacity = "1";
            });
          }
        }, 1000);
      }
    }

    function checkFinalAnswer() {
      const ans = document.getElementById("final-answer").value.trim();
      const result = document.getElementById("final-result");
      const survey = document.getElementById("survey-link");

      if (ans === finalAnswer) {
        result.innerHTML = "ğŸ‰ ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼";
        result.classList.add("success");
        playSound("goal-sound");
        confetti();
        survey.innerHTML = `<p><a href="https://forms.gle/mfHe6rbxjTjCdYtG6" target="_blank">æ¬¡ã¸</a></p>`;
      } else {
        result.innerHTML = "âŒ ç­”ãˆãŒé•ã†ã¿ãŸã„ã â€¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¦‹ç›´ã—ã¦ã¿ã‚ˆã†ï¼";
        survey.innerHTML = "";
        playSound("wrong-sound");
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã¨ãƒãƒƒã‚·ãƒ¥å¤‰æ›´æ™‚ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    window.addEventListener("load", renderPage);
    window.addEventListener("hashchange", renderPage);

    // --- è¿½åŠ ã™ã‚‹ JS: collected keywords ã®å–å¾—ï¼†ãƒœãƒˆãƒ æ›´æ–° ---
function getCollectedKeywordsArray() {
  const arr = [];
  Object.keys(quizzes).forEach(id => {
    const k = localStorage.getItem(`quiz${id}_cleared`);
    if (k) arr.push(k);
  });
  return arr; // ä¾‹: ["ãƒ„", "ãƒ£"]
}

function renderCollectedKeywordsHTML_forBottom() {
  const arr = getCollectedKeywordsArray();
  if (arr.length === 0) return '';
  // å„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ–‡å­—ã”ã¨ã« <span class="char"> ã«ã—ã¦çµåˆï¼ˆæœ€çµ‚å•é¡Œã¨åŒã˜è¦‹ãŸç›®ï¼‰
  return `<div class="keyword">` +
    arr.map(k => k.split('').map(ch => `<span class="char">${ch}</span>`).join('')).join('') +
    `</div>`;
}

function updateCollectedKeywordsBottom() {
  const el = document.getElementById('collected-keywords-bottom');
  if (!el) return;
  const html = renderCollectedKeywordsHTML_forBottom();
  if (html) {
    el.innerHTML = html;
    el.style.display = 'block';
  } else {
    el.innerHTML = '';
    el.style.display = 'none';
  }
}

// åˆæœŸè¡¨ç¤ºã¨ãƒãƒƒã‚·ãƒ¥å¤‰æ›´æ™‚ã«æ›´æ–°ï¼ˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«å‘¼ã°ã‚Œã‚‹ã®ã§å®‰å…¨ï¼‰
window.addEventListener('load', updateCollectedKeywordsBottom);
window.addEventListener('hashchange', updateCollectedKeywordsBottom);

  </script>
  <!-- è¿½åŠ : ç”»é¢ä¸‹éƒ¨ã«ç²å¾—ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‡ºã™é ˜åŸŸ -->
<div id="collected-keywords-bottom" aria-live="polite"></div>

</body>
</html>
